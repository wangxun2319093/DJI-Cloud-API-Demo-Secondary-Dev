## 问题分析总结

### 发现的问题

1. **模拟器缺少 status 上线消息**

   * 当前模拟器只发送 OSD 数据，没有发送大疆上云 API 要求的 `status` 上线消息

   * 导致设备未在后端注册，Redis 中没有在线状态

2. **DRONE\_GATEWAY\_001 未在 Redis 注册**

   * Redis 中只有 `online:GATEWAYSIM001`，没有 `online:DRONE_GATEWAY_001`

   * 前端判断设备在线状态依赖 Redis，所以显示无人机离线

3. **DOCKSIM001 报错**

   * DOCKSIM001 发送 OSD 数据但未注册，导致后端报错

### 解决方案

修改 `gateway_simulator.py`，添加设备上线流程：

1. 连接 MQTT 后，发送 `thing/product/{GATEWAY_SN}/status` 消息
2. status 消息包含：domain, type, subType, deviceSecret, nonce, thingVersion, subDevices
3. 子设备信息包含 DRONE\_GATEWAY\_001 的设备信息

### 修改内容

```python
# 添加 status 上线消息发送
def create_status_message():
    return {
        "tid": str(uuid.uuid4()),
        "bid": str(uuid.uuid4()),
        "timestamp": int(time.time() * 1000),
        "data": {
            "domain": 2,  # REMOTER_CONTROL
            "type": 119,  # DJI RC Plus
            "sub_type": 0,
            "device_secret": "secret",
            "nonce": "nonce",
            "thing_version": "1.0.0",
            "sub_devices": [{
                "sn": DRONE_SN,
                "domain": 1,  # DRONE
                "type": 89,   # M30T
                "sub_type": 0,
                "index": "A",
                "device_secret": "secret",
                "nonce": "nonce",
                "thing_version": "1.0.0"
            }]
        }
    }

# 连接后发送 status 消息
client.publish(f"thing/product/{GATEWAY_SN}/status", json.dumps(status_msg))
```


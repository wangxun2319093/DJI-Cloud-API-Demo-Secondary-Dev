# DJI 航线编辑器迁移集成计划

## 一、项目分析总结

### 源项目 (dji\_way\_line)

* **框架**: Vue 3.5 + Vite 5 + UnoCSS

* **UI库**: Ant Design Vue 4.2

* **地图**: Vue-Cesium 3.2 + Cesium 1.135

* **核心组件**: 8个 Vue 组件 + 6个工具函数

### 目标项目 (DJI-Cloud-API-Demo/front)

* **框架**: Vue 3.2 + Vite 2 + SCSS

* **UI库**: Ant Design Vue 2.2

* **地图**: 原生 Cesium 1.138

* **布局**: 左侧 Sidebar(50px) + 内容区(285px) + 右侧地图

***

## 二、迁移步骤

### 阶段1: 创建目录结构和复制工具函数

**1.1 创建组件目录**

```
front/src/components/wayline/
├── index.vue                    # 主入口(新建，抽屉容器)
├── ControlPanel.vue            # 控制面板(复制)
├── MissionConfig.vue          # 任务配置(复制)
├── MissionLibrary.vue          # 航线库(复制)
├── CreateMissionModal.vue      # 创建模态框(复制)
├── PolygonRouteConfig.vue      # 面状航线配置(复制)
├── WaypointList.vue            # 航点列表(复制)
└── use-wayline.ts              # 航线编辑状态管理(新建)
```

**1.2 创建工具函数目录**

```
front/src/utils/wayline/
├── coordTransform.ts           # 坐标转换
├── geoUtils.ts                 # 地理计算
├── kmzGenerator.ts             # KMZ 生成
├── kmzParser.ts                 # KMZ 解析
├── routePlanner.ts             # 路径规划
└── polygonRouteGenerator.ts    # 面状航线生成
```

***

### 阶段2: 集成 MapViewer 功能到 CesiumMap.vue

**2.1 新增航线编辑状态管理**

* 在 CesiumMap.vue 中添加航点、扫描路径等状态

* 添加航线编辑模式切换逻辑

**2.2 新增地图实体渲染**

* 航点标记 (vc-entity 替换为原生 Cesium.Entity)

* 航线连接线 (vc-graphics-polyline 替换为 Cesium.PolylineGraphics)

* 多边形区域 (vc-graphics-polygon 替换为 Cesium.PolygonGraphics)

* S形扫描路径渲染

**2.3 新增地图点击事件处理**

* 航线编辑模式下点击添加航点

* 坐标转换 (WGS84 ↔ GCJ-02)

**2.4 新增坐标系统信息显示**

* 右下角显示 WGS84 坐标系统标识

***

### 阶段3: 创建航线编辑抽屉入口

**3.1 修改 sidebar.vue**

* 添加"航线编辑"菜单项图标

* 点击触发抽屉打开/关闭

**3.2 创建抽屉容器组件**

* 使用 Ant Design Vue 的 Drawer 组件

* 从左侧滑出，宽度 420px

* 包含 MissionLibrary 和 ControlPanel 切换

**3.3 修改 workspace.vue**

* 集成航线编辑抽屉组件

* 传递地图点击事件到航线编辑器

***

### 阶段4: 组件迁移和适配

**4.1 ControlPanel.vue 适配**

* 保持原有样式和布局

* 适配 Ant Design Vue 2.2 API 差异

* 调整 emit 事件名称符合项目规范

**4.2 MissionConfig.vue 适配**

* 保持原有样式和布局

* SVG 图示保持不变

* 表单组件适配

**4.3 MissionLibrary.vue 适配**

* 保持原有样式和布局

* localStorage 持久化逻辑保留

**4.4 CreateMissionModal.vue 适配**

* 保持原有样式和布局

* 机型选择功能保留

**4.5 PolygonRouteConfig.vue 适配**

* 保持原有样式和布局

* 相机参数配置保留

**4.6 WaypointList.vue 适配**

* 保持原有样式和布局

* 航点编辑/删除功能保留

***

### 阶段5: 工具函数迁移

**5.1 coordTransform.js → coordTransform.ts**

* 转换为 TypeScript

* 添加类型定义

**5.2 geoUtils.js → geoUtils.ts**

* 转换为 TypeScript

* 添加类型定义

**5.3 kmzGenerator.js → kmzGenerator.ts**

* 转换为 TypeScript

* 适配项目已有的 jszip 使用方式

**5.4 kmzParser.js → kmzParser.ts**

* 转换为 TypeScript

* 适配项目已有的 fast-xml-parser

**5.5 routePlanner.js → routePlanner.ts**

* 转换为 TypeScript

* 添加类型定义

**5.6 polygonRouteGenerator.js → polygonRouteGenerator.ts**

* 转换为 TypeScript

* 添加类型定义

***

### 阶段6: 状态管理和路由配置

**6.1 Vuex Store 扩展**

* 添加航线编辑相关状态

* 航线库数据管理

**6.2 路由配置**

* 无需新增路由，使用抽屉方式

***

## 三、技术适配要点

### 3.1 Ant Design Vue 版本差异

* 2.x → 4.x 部分组件 API 变化需适配

* 主要是 a-select-option 写法、v-model 语法等

### 3.2 Cesium 集成方式差异

* dji\_way\_line: 使用 vue-cesium 组件封装

* DJI-Cloud-API-Demo: 使用原生 Cesium API

* 需将 vc-entity 等组件改为原生 Entity API

### 3.3 样式方案差异

* dji\_way\_line: UnoCSS 原子化 CSS

* DJI-Cloud-API-Demo: SCSS + scoped

* 迁移组件需将 UnoCSS 类转换为内联样式或 SCSS

***

## 四、文件清单

### 新建文件 (2个)

1. `front/src/components/wayline/index.vue` - 抽屉容器
2. `front/src/components/wayline/use-wayline.ts` - 状态管理

### 复制文件 (11个)

1. `front/src/components/wayline/ControlPanel.vue`
2. `front/src/components/wayline/MissionConfig.vue`
3. `front/src/components/wayline/MissionLibrary.vue`
4. `front/src/components/wayline/CreateMissionModal.vue`
5. `front/src/components/wayline/PolygonRouteConfig.vue`
6. `front/src/components/wayline/WaypointList.vue`
7. `front/src/utils/wayline/coordTransform.ts`
8. `front/src/utils/wayline/geoUtils.ts`
9. `front/src/utils/wayline/kmzGenerator.ts`
10. `front/src/utils/wayline/kmzParser.ts`
11. `front/src/utils/wayline/routePlanner.ts`
12. `front/src/utils/wayline/polygonRouteGenerator.ts`

### 修改文件 (3个)

1. `front/src/components/CesiumMap.vue` - 集成 MapViewer 功能
2. `front/src/components/common/sidebar.vue` - 添加航线编辑入口
3. `front/src/pages/page-web/projects/workspace.vue` - 集成抽屉组件

***

## 五、预期效果

1. 点击侧边栏"航线编辑"图标，从左侧滑出抽屉面板
2. 抽屉内显示航线库列表或航线编辑控制面板
3. 地图上实时显示航点、航线、扫描路径
4. 所有原有功能完整保留
5. 不修改后端代码

